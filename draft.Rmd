---
title: "Final Project - Stroke Predictions"
author: "Group 10"
output: 
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
---

```{r setup, include=FALSE}
options(knitr.duplicate.label = "allow")
knitr::opts_chunk$set(echo = TRUE)
library(prettydoc)
library(ggplot2)
library(plotly)
library(dplyr)
library(tidyverse)
library(caret)
library(DT)
```


```{r, echo = FALSE, message = FALSE}

# bring in the data
stroke = read_csv("stroke.csv")

```


# Question and Initial Research

How can we most accurately predict if someone will have a stroke and what are the most important predictive factors?

Being able to answer this question would provide many benefits. According to the CDC, strokes are one of the leading causes of death in the U.S. The World Health Organization also reports stroke as one of the leading causes of death worldwide. They are hard to deal with, and being able to predict and therefore prevent them would be useful. If high-risk individuals could be identified, they could also be informed of warning signs of stroke to look out for, as stroke survival rates are much higher when emergency treatment begins quickly. 

```{r fig.width=6, fig.height=6,echo=FALSE,fig.align="center"}
library(png)
library(grid)
img <- readPNG("death_worlwide.png")
 grid.raster(img)
```

Being able to accurately predict strokes and therefore prevent them would also have economic benefits. According to the CDC, stroke-related costs in the United States were nearly $46 billion between 2014 and 2015, including the cost of health care services, medicines to treat stroke, and missed days of work. Strokes are also one of the leading causes of serious long-term disability. Strokes reduce mobility in more than 50% of stroke survivors over the age of 65.

We found a dataset on Kaggle to use that includes records from both ischemic and hemorrhagic strokes. The criteria used to define a stroke was that a stroke occurs when a blood vessel that carries oxygen and nutrients to the brain is either blocked (ischemic) by a clot or bursts (hemorrhagic). This dataset includes 11 unique features of each patient, in addition to whether or not they had a stroke. The recorded features are:

- patient identification number
- gender
- age
- presence of hypertension 
- presence of heart disease
- marital status
- job type
- residence type
- average glucose level 
- BMI
- smoking status 

The CDC indicates that high blood pressure, high cholesterol, smoking, obesity, and diabetes are leading causes of stroke. From this data analysis, we would therefore expect to see that smoking status, BMI, hypertension, and heart disease would be the most important factors in predicting stroke. 


# Exploratory Data Analysis


Exploratory data analysis is important for us to better understand this dataset before we go into deeper analysis. We want to identify the most important variables and variables that aren't as useful. We also want to identify possible outliers, missing values, and understand the relationship between variables. Ultimately, the goal is to maximize our insight of the dataset to minimize potential error that could occur later in the process.


#### First Glance 


A first look at the data:

```{r, echo = FALSE}
str(stroke)
```


#### Summary Statistics

Initial summary statistics, after re-classing some of the variables:

```{r, echo = FALSE}
# changing variable types for analysis and replacing missing values
stroke$bmi <- gsub("N/A", NA, stroke$bmi)
stroke$smoking_status <- gsub("Unknown", NA, stroke$smoking_status) #replacing unknown with NA is smoking status
stroke$gender <- as.factor(stroke$gender)
stroke$bmi <- as.numeric(stroke$bmi)
stroke$age <- as.numeric(stroke$age)
stroke$avg_glucose_level <- as.numeric(stroke$avg_glucose_level)
stroke$ever_married <- as.factor(stroke$ever_married)
stroke$work_type <- as.factor(stroke$work_type)
stroke$Residence_type <- as.factor(stroke$Residence_type)
stroke$smoking_status <- as.factor(stroke$smoking_status)
stroke$hypertension <- as.factor(stroke$hypertension)
stroke$heart_disease <- as.factor(stroke$heart_disease)
stroke$stroke <- as.factor(stroke$stroke)

summary(stroke)

```

The dataset contains data from 5110 patients. It is pretty evenly split with gender, 59% female and 41% male. The binary variables hypertension and heart disease are much less balanced, with only 9.75% of the patients having hypertension and 5.40% of them having heart disease. According to the American Heart Association, almost half of adults in the U.S. have hypertension, or chronically high blood pressure, which is directly related to heart disease. So, the dataset may not accurately represent the population, but it could still be used to analyze predictive factors for strokes. The prevalence of stroke in this dataset is 4.87%.


The dataset is pretty evenly split among gender.

```{r, echo = FALSE}
stroke <- as_tibble(stroke)
barplot(table(stroke$gender))
```

The two variables we are most interested in are not very balanced. On the left is a histogram for hypertension, and on the right is one for heart disease. As mentioned before, only 9.75% of the patients have hypertension and 5.40% of them have heart disease. This could lead to issues in creating predictive models later.

```{r, echo = FALSE, figures-side, fig.show = "hold", out.width="50%"}
stroke <- as_tibble(stroke)
barplot(table(stroke$hypertension))
barplot(table(stroke$heart_disease))
```


 
Smoking and BMI could also be of interest.

```{r, echo = FALSE, fig.show = "hold", out.width="50%"}
stroke <- as_tibble(stroke)
barplot(table(stroke$smoking_status))
barplot(table(stroke$bmi))
```


The average BMI is 28.89, which is classified as overweight. Being overweight or obese increases your risk for heart disease and stroke (but then again BMI isn't a completely accurate measurement). Based on the information from the CDC, we would expect patients who smoke or even formerly smoked or with higher BMIs would have a higher incidence of stroke.


#### Visualizations

Next we wanted to look at some visualizations of numeric variables we think will be important in stroke predictions, other than the important binary variables like hypertension and heart disease.


```{r, echo = FALSE, message = FALSE,warning = FALSE}
# plotting the distribution of bmi based on smoking status 

# plotting distribution of bmi based on hypertension 

#plotting sitribution of bmi based on heart disease

#plotting distribution of bmi based on incidence of stroke?

#plotting smoking status vs glucose level?

# strip plots?

# plotting bmi with stroke incidence
ggplot(stroke, 
       aes(y = stroke,
           x = bmi,
           color = stroke)) +
   geom_jitter(alpha = 0.2,
              width = .1) + 
  geom_boxplot(size = 1,
               outlier.shape = 1,
               outlier.color = "black",
               outlier.size = 3,
               color="black",
               alpha=0.2) +
  labs(title = "BMI distribution with Stroke Incidence")
```

The bmi vs. stroke incidence chart shows that the average bmi for patients who had a stroke was higher than those who didn't. 


Diabetes is also another risk factor for stroke. Although this dataset does not have presence of diabetes as a variable, it does have average glucose level, which can be used to classify if patients are diabetic. The American Diabetes Association classifies normal blood glucose levels as less than 100 mg/dl, prediabetes is 100 mg/dl to 125 mg/dl, and diabetes is 126 mg/dl or higher. Looking at a plot of average blood glucose levels 

```{r,echo = FALSE, message = FALSE}
#plotting avg. glucose level with stroke incidence
ggplot(stroke, 
       aes(y = stroke,
           x = avg_glucose_level,
           color = stroke)) +
   geom_jitter(alpha = 0.2,
              width = .1) + 
  geom_boxplot(size = 1,
               outlier.shape = 1,
               outlier.color = "black",
               outlier.size = 3,
               color="black",
               alpha=0.2) +
  labs(title = " Average Glucose Level Distribution with Stroke Incidence")
```


This graph doesn't give quite as clear of a result as the previous one, mainly because the distribution of the data is a little strange. There's a lot of people with somewhat normal levels and then a lot of people with high levels, but not as many in between. The average glucose level was still higher for patients who had a stroke.


Another numeric variable that would be interestng to look at would be age, as the risk for stroke increases with age.

```{r, echo = FALSE, message = FALSE}
#plotting age vs. stroke incidence
ggplot(stroke, 
       aes(y = stroke,
           x = age,
           color = stroke)) +
   geom_jitter(alpha = 0.2,
              width = .1) + 

  labs(title = "Age Distribution with Stroke Incidence")
```


The scatterplot cleary indicates that those patients who had strokes were older, 40+ years on average.


As confirmed by some of the research we did, the most at-risk patient would be someone with hypertension and heart-disease, with a high bmi and average glucose level, who smokes, and who is older.



#### Variable Correlation


```{r, echo = FALSE, results = FALSE}
# Correlation 
stroke <- read.csv("stroke.csv")
stroke$bmi <- gsub("N/A", NA, stroke$bmi)
stroke$smoking_status <- gsub("Unknown", NA, stroke$smoking_status)
stroke <- na.omit(stroke)
stroke <- stroke[ -c(1)]
str(stroke)

stroke$gender <- as.factor(stroke$gender)
stroke$ever_married <- as.factor(stroke$ever_married)
stroke$work_type <- as.factor(stroke$work_type)
stroke$Residence_type <- as.factor(stroke$Residence_type)
stroke$smoking_status <- as.factor(stroke$smoking_status)


stroke <- lapply(stroke, function(x) as.numeric(x))

stroke <- as_tibble(stroke)


stroke_correlations <- cor(stroke)
datatable(stroke_correlations)
```


Something that would be interesting to look at would be the correlation between variables, to see if any of the variables vary in similar ways.


```{r, echo = FALSE, message = FALSE}
install.packages("corrplot")
library(corrplot)
corrplot(stroke_correlations, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)
```


This is a visualization of the correlation plot, which confirms that no variables appear to be highly correlated with one another. There is small correlations between age and hypertension, heart disease, high glucose levels, and stroke incidence. Some of the common comorbid conditions also have smaller correlation levels, like heart disease, stroke, hypertension, and average glucose level.


# Methods and Evaluation
Do evaluation with each method, not all after
  
•	Methods – Techniques you are using to address your question and the results of those methods.
•	Evaluation of your model – Select appropriate metrics and explain the output as it relates to your question.

## KNN

## Clustering

## Decision

## Random Forest

# Fairness Assessment
•	Fairness assessment – if necessary, should you happen to have any protected classes.

# Conclusions
•	Conclusions – What can you say about the results of the methods section as it relates to your question given the limitations to your model. 

# Future Work
•	Future work – What additional analysis is needed or what limited your analysis on this project.

-the dataset was kind of unbalanced


# References 

https://www.cdc.gov/stroke/facts.htm

https://www.kaggle.com/fedesoriano/stroke-prediction-dataset

https://www.cdc.gov/bloodpressure/facts.htm#:~:text=Nearly%20half%20of%20adults%20in,are%20taking%20medication%20for%20hypertension.&text=Only%20about%201%20in%204,have%20their%20condition%20under%20control.

https://www.sciencedaily.com/releases/2019/01/190131084238.htm#:~:text=01%2F190131084238.htm-,At%20least%2048%20percent%20of%20all%20adults%20in%20the%20United,according%20to%20the%20latest%20statistics.

https://towardsdatascience.com/exploratory-data-analysis-in-r-for-beginners-fe031add7072

https://www.diabetes.org/a1c/diagnosis






